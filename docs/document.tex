% ZÁVĚREČNÁ STUDIJNÍ PRÁCE - DOKUMENTACE
% Mobilní geolokační aplikace pro geocaching s podporou offline režimu a herními prvky
% Autor: Antonín Bujnovský
%
\documentclass[12pt, a4paper,
twoside, % Zapnutí oboustranného sázení pro zrcadlové okraje
openright % Kapitoly začínají vždy na pravé straně (liché)
]{report}

% Definice příkazu pro vynucení startu na pravé (liché) straně
% a vložení úplně čisté prázdné stránky na rubu.
\newcommand{\forceoddpage}{%
	\clearpage % Ukončí aktuální stránku a vykreslí nezpracované obrázky
	\ifodd\value{page}
	% Pokud jsme na liché straně, nic neděláme (další text začne vlevo),
	% ale ty jsi chtěl prázdnou stránku "mezi", tak se tato podmínka 
	% obvykle doplňuje o \else větev níže.
	\else
	% Pokud je aktuální číslo stránky sudé, vložíme prázdnou lícovou stranu
	\thispagestyle{empty} % Stránka bude bez čísel a čar
	\hbox{}               % Vložíme neviditelný znak, aby LaTeX stránku nevyhodil
	\newpage              % Přejdeme na další stranu
	\fi
}

% --- BALÍČKY PRO OBRÁZKY (Nahráno na začátku pro stabilitu) ---
\usepackage{graphicx}
\usepackage{letltxmacro}
\usepackage[T1]{fontenc}

% --- Ošetření obrázků pro bezchybnou kompilaci v preview ---
% Použití \detokenize opravuje chybu "Missing $ inserted" u podtržítek v názvech
\LetLtxMacro\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{\IfFileExists{#2}{\oldincludegraphics[#1]{#2}}{\framebox[\if\relax\detokenize{#1}\relax 0.5\linewidth\else \expandafter\getwidth#1 \fi]{\rule{0pt}{3cm} Soubor \detokenize{#2} nenalezen}}}
\def\getwidth width=#1 #2{#1}

% --- ZÁKAZ DĚLENÍ SLOV A TYPOGRAFICKÁ STABILITA ---
\hyphenpenalty=10000
\exhyphenpenalty=10000
\widowpenalty=10000
\clubpenalty=10000
\interlinepenalty=5000
\tolerance=2000 
\emergencystretch=15pt
\sloppy 

% --- odstraneni zbytkoveho textu "superiorSup" a pod. ---
\AtBeginDocument{%
	\let\superiorSup\relax
	\let\textOsF\relax
	\let\textTOsF\relax
	\let\liningLF\relax
	\let\liningTLF\relax
	\let\tabularTab\relax
	\let\proportionalProp\relax
	\let\tabularmath\relax
	\let\proportionalmath\relax
	\let\fontspechyperref\relax
}

%% Proměnné
\newcommand\obor{INFORMAČNÍ TECHNOLOGIE}
\newcommand\kodOboru{18-20-M/01}
\newcommand\zamereni{se zaměřením na počítačové sítě a programování}
\newcommand\skola{Střední škola průmyslová a umělecká, Opava}
\newcommand\trida{IT4}
\newcommand\jmenoAutora{Antonín Bujnovský}
\newcommand\skolniRok{2025/2026}
\newcommand\datumOdevzdani{\today}
\newcommand\nazevPrace{Mobilní geolokační aplikace pro geocaching \\ s podporou offline režimu a herními prvky}

\title{\nazevPrace}
\author{\jmenoAutora}
\date{\datumOdevzdani}

% --- NASTAVENÍ ZRCADLOVÝCH OKRAJŮ (inner=3.5cm pro vazbu) ---
\usepackage[top=2.5cm, bottom=2.5cm, inner=3.5cm, outer=2.5cm]{geometry}

\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
\usepackage{cmap}

\usepackage{subcaption}
\usepackage{float}
\usepackage{placeins}
\usepackage{hyperref}
\usepackage{needspace}

\linespread{1.25}
\setlength{\parskip}{0.5em}

\usepackage[pagestyles]{titlesec}
% Needspace zajistí, že nadpis neuteče na novou stránku bez textu
\titleformat{\chapter}[block]{\needspace{6\baselineskip}\scshape\bfseries\LARGE}{\thechapter}{10pt}{\vspace{0pt}}[\vspace{-22pt}]
\titleformat{\section}[block]{\needspace{4\baselineskip}\scshape\bfseries\Large}{\thesection}{10pt}{\vspace{0pt}}
\titleformat{\subsection}[block]{\needspace{3\baselineskip}\bfseries\large}{\thesubsection}{10pt}{\vspace{0pt}}

\usepackage{tocloft}
\setlength{\cftbeforechapskip}{0.20em}
\setlength{\cftbeforesecskip}{0.10em}
\setlength{\cftsubsecindent}{1.5em}
\setlength{\cftsubsubsecindent}{3em}
\setlength{\cftchapnumwidth}{2em}
\setlength{\cftsecnumwidth}{2.5em}
\setlength{\cftsubsecnumwidth}{3em}
\setlength{\cftaftertoctitleskip}{0pt}
\renewcommand{\cftchapfont}{\normalsize\bfseries}
\renewcommand{\cftsecfont}{\normalsize}
\renewcommand{\cftsubsecfont}{\small}
\renewcommand{\cftsubsubsecfont}{\small}
\renewcommand{\cftchappagefont}{\normalsize}
\renewcommand{\cftsecpagefont}{\normalsize}
\renewcommand{\cftsubsecpagefont}{\small}
\renewcommand{\cftsubsubsecpagefont}{\small}

\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0.025pt}
\fancyhf{}
\fancyfoot[C]{\thepage}

\usepackage{booktabs}
\usepackage{url}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{enumitem}

% Nastavení pro kód
\lstset{
	basicstyle=\ttfamily\small,
	breaklines=true,
	frame=single,
	backgroundcolor=\color{gray!10},
	language=Python,
	keywordstyle=\color{blue},
	stringstyle=\color{red},
	commentstyle=\color{green!60!black}
}

\renewcommand{\lstlistingname}{Kód}
\renewcommand{\lstlistlistingname}{Seznam programových kódů}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{helvet}
\usepackage{mathptmx}
\usepackage{Oswald}

\makeatletter
\@namedef{ver@figureversions.sty}{9999/99/99}
\newcommand{\DeclareFigureVersion}[2]{}
\makeatother

\makeatletter
\providecommand{\superiorSup}{}
\providecommand{\textOsF}{}
\providecommand{\textTOsF}{}
\providecommand{\liningLF}{}
\providecommand{\liningTLF}{}
\providecommand{\tabularTab}{}
\providecommand{\proportionalProp}{}
\providecommand{\tabularmath}{}
\providecommand{\proportionalmath}{}
\makeatother

\setlength{\headheight}{15pt}

% Úprava pro prázdné stránky při oboustranném tisku
\let\oldcleardoublepage\cleardoublepage
\renewcommand{\cleardoublepage}{%
	\clearpage\if@twoside \ifodd\c@page\else
	\hbox{}
	\thispagestyle{empty}
	\newpage
	\if@twocolumn\hbox{}\newpage\fi\fi\fi}

\begin{document}
	
	\pagestyle{empty}
	\pagenumbering{arabic}
	
	%% Titulní stránka
	\thispagestyle{empty}
	{\fontfamily{phv}\selectfont
		\vspace*{-1.2cm}
		%% Logo školy
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.45\linewidth]{img/logo-skoly.png}
		\end{figure}
		
		{\bfseries
			\begin{center}
				\vspace{0.3cm}
				\LARGE{ZÁVĚREČNÁ STUDIJNÍ PRÁCE}\\
				\large{dokumentace}\\
				\vspace{0.8cm}
				\LARGE {\nazevPrace}\\
			\end{center}   
		}
		
		\vspace{0.4cm}
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.0\linewidth]{img/logo.jpg} 
		\end{figure}
		
		\vspace{0.8cm}
		\begin{center}
			\begin{tabular}{ll}
				\textbf{Autor:} & \jmenoAutora\\ 
				\textbf{Obor:} & \kodOboru~{}\obor\\
				\textbf{} & \zamereni\\
				\textbf{Třída:} & \trida\\
				\textbf{Školní rok:} & \skolniRok\\
			\end{tabular}
		\end{center}
		\vfill
	}
	\forceoddpage
	
	%% Poděkování a prohlášení
	\noindent{\large{\bfseries{Poděkování}\\}}
	\noindent Rád bych touto cestou vyjádřil upřímné poděkování pánům učitelům Ing.~Petru Grussmannovi a~Mgr.~Marku Lučnému za~jejich ochotu, odborné připomínky a~čas, který mi věnovali při konzultacích během vývoje aplikace GeoHunt.
	
	\vspace*{0.5\textheight}
	
	\noindent{\large{\bfseries{Prohlášení}\\}}
	\noindent{Prohlašuji, že~jsem závěrečnou práci vypracoval samostatně a~uvedl veškeré použité informační zdroje. \par}
	\vspace{0.3cm}
	\noindent{Souhlasím, aby tato studijní práce byla použita k~výukovým a~prezentačním účelům na~Střední průmyslové a~umělecké škole v~Opavě, Praskova~399/8.}
	
	\vfill
	
	\noindent V~Opavě~dne~\datumOdevzdani \par
	
	\vspace{0.5cm}
	
	\begin{flushright}
		\begin{minipage}{6cm}
			\centering
			\dotfill \\
			Podpis autora
		\end{minipage}
	\end{flushright}
	
\forceoddpage
	
	%% Abstrakt
	\noindent{\Large{\bfseries{Abstrakt}\\}}
	\noindent Tato maturitní práce se zabývá návrhem a~realizací mobilní geolokační aplikace GeoHunt, která je určena pro příznivce geocachingu. Cílem projektu bylo vytvořit stabilní a~výkonnou platformu v~prostředí Flutter s~využitím cloudového řešení Supabase. Práce detailně popisuje technické výzvy spojené s~optimalizací zobrazení velkého množství bodů zájmu na~mapě, implementaci herních prvků pro odemykání obsahu a~zajištění funkčnosti v~offline režimu pomocí lokální SQLite databáze. Výsledkem je plně funkční aplikace, která kombinuje moderní technologie s~prvky gamifikace pro zlepšení uživatelského zážitku v~terénu.
	
	\vspace{18pt}
	
	\noindent{\large{\bfseries{Klíčová slova}}}
	
	\noindent Flutter, Geocaching, Supabase, Dart, Geolokace, Mobilní aplikace, PostgreSQL, Gamifikace, Offline synchronizace.
	\vspace{18pt}
	
	\noindent{\Large{\bfseries{Abstract}}}
	
	\noindent This graduation thesis focuses on the design and implementation of the GeoHunt mobile geolocation application, intended for geocaching enthusiasts. The goal of the project was to develop a stable and high-performance platform using the Flutter framework and Supabase cloud services. The thesis describes in detail the technical challenges associated with optimizing the display of a large number of points of interest on a map, the implementation of gaming elements for unlocking content, and ensuring offline functionality using a local SQLite database. The result is a fully functional application that combines modern technologies with gamification elements to enhance the user experience in the field.
	
	\vspace{18pt}
	
	\noindent{\large{\bfseries{Keywords}}}
	
	\noindent Flutter, Geocaching, Supabase, Dart, Geolocation, Mobile application, PostgreSQL, Gamification, Offline synchronization.
	
\forceoddpage
	
	%% Obsah
	\pagestyle{fancy}
	\enlargethispage{3cm} 
	\vspace*{-1.5cm}
	\begingroup
	\renewcommand{\baselinestretch}{1.0}\normalsize
	\renewcommand{\cftchapfont}{\large\bfseries}
	\renewcommand{\cftsecfont}{\normalsize}
	\renewcommand{\cftsubsecfont}{\normalsize}
	\renewcommand{\cftsubsubsecfont}{\normalsize}
	\renewcommand{\cftchappagefont}{\large\bfseries}
	\renewcommand{\cftsecpagefont}{\normalsize}
	\renewcommand{\cftsubsecpagefont}{\normalsize}
	\renewcommand{\cftsubsubsecpagefont}{\normalsize}
	\tableofcontents
	\endgroup
	
\forceoddpage
	
	\pagenumbering{arabic}
	\setcounter{page}{9}
	\pagestyle{fancy}
	
	%% Úvod
	\chapter*{Úvod}
	\addcontentsline{toc}{chapter}{Úvod}
	
	V~dnešním digitálním světě se hranice mezi volnočasovými aktivitami a~moderními technologiemi neustále stírají. Geocaching, jakožto celosvětově rozšířený fenomén propojující turistiku s~vyhledáváním skrytých schránek, představuje ideální příklad této symbiózy. Ačkoliv na~trhu existuje řada nástrojů pro tuto aktivitu, mnoho z~nich naráží na~technická omezení v~podobě nízkého výkonu při zobrazení velkého množství dat, nespolehlivosti v~oblastech bez stabilního internetového připojení nebo závislosti na fyzických schránkách. 
	
	Hlavní motivací pro výběr tohoto tématu byla snaha vytvořit komplexní mobilní řešení, které tyto bariéry odstraňuje a~zároveň obohacuje tradiční geocaching o~moderní herní prvky. Zvolená kombinace technologií Flutter a~Supabase nabízí progresivní přístup k~vývoji, který umožňuje velkou míru interaktivity, plynulost uživatelského rozhraní a~vysokou stabilitu systému. Klíčovou technickou výzvou projektu bylo především efektivní vykreslování desítek tisíc bodů zájmu na~mapových podkladech a~zajištění plné funkčnosti aplikace i~v~náročných podmínkách terénu bez přístupu k~síti.
	
	Cílem této práce je dokumentace kompletního cyklu vývoje softwarového produktu GeoHunt – od~teoretického vymezení použitých technologií přes analýzu uživatelských potřeb až po praktickou implementaci klíčových funkcí, jako je geolokace, offline synchronizace a~gamifikace. Práce si klade za~cíl demonstrovat, že~pomocí moderních frameworků lze vytvořit robustní a~uživatelsky přívětivou platformu, která motivuje studenty i~širší veřejnost k~aktivnímu pohybu a~objevování okolního světa.
	
	\forceoddpage
	\chapter{Teoretická a metodická východiska}
	
	\section{O projektu}
	Výsledkem tohoto maturitního projektu je komplexní mobilní aplikace GeoHunt, která modernizuje tradiční koncept geocachingu. Cílem práce bylo navrhnout a~realizovat systém, který propojuje fyzickou aktivitu v~přírodě s~digitálními herními prvky. GeoHunt umožňuje uživatelům vyhledávat virtuální objekty (kešky) na~základě GPS souřadnic v~reálném čase.
	
	Klíčovým prvkem, kterým se projekt odlišuje od~stávajících řešení, je zavedení interaktivních mini-her. Po~dosažení fyzické lokace kešky se uživateli neotevře obsah automaticky, ale musí nejprve úspěšně absolvovat jednu náhodně vybranou mini-hru ze~dvou dostupných variant. Aplikace nabízí AR Coin Hunt využívající kameru a~gyro senzory pro~360° pohled a~Falling Fragments, kde hráč ovládá koš pro~zachytávání padajících objektů. Tento přístup zvyšuje interaktivitu aplikace a~motivuje hráče k~lepším výkonům. Součástí projektu je také systém hodnocení kešek, žebříček nejlepších hráčů a~úplná podpora offline režimu, která je nezbytná pro~použití v~místech s~omezeným mobilním signálem.
	
	
	\section{Framework Flutter a programovací jazyk Dart}
	Pro~vývoj klientské části aplikace jsem zvolil framework Flutter od~společnosti Google. Jedná se o~moderní UI toolkit, který umožňuje vytvářet nativně kompilované aplikace pro~mobilní zařízení, web i~desktop z~jediné kódové báze. Hlavním argumentem pro~volbu tohoto nástroje byla jeho schopnost vykreslovat složitá rozhraní (včetně mapových podkladů s~tisíci body) rychlostí až 120~snímků za~sekundu díky grafickému engine Impeller a~taky moje zkušenost s~tímto frameworkem.
	
	Programovací jazyk Dart, na~kterém je Flutter postaven, nabízí silnou typovou kontrolu a~vynikající podporu pro~asynchronní operace, což je pro~geolokační aplikaci pracující s~externími API kritické. Funkce \textit{Hot Reload} navíc umožnila plynulý vývojový cyklus s~okamžitou vizuální odezvou na~změny v~kódu.
	
	
	\section{Architektonický vzor Clean Architecture}
	Aby byl projekt GeoHunt udržitelný a~snadno testovatelný, tak jsem implementoval architekturu \textit{Clean Architecture}. Tato metodika striktně odděluje obchodní logiku od~vnějších vlivů, jako jsou databáze nebo uživatelské rozhraní. Projekt je rozdělen do~tří nezávislých vrstev:
	\begin{itemize}
		\item \textbf{Domain layer:} Jádro aplikace obsahující entity a~rozhraní repozitářů. Je nezávislá na~Flutteru i~backendu.
		\item \textbf{Data layer:} Implementace repozitářů, která zajišťuje komunikaci se Supabase a~lokální cache v~SQLite.
		\item \textbf{Presentation layer:} Obsahuje uživatelské rozhraní (Widgety) a~logiku pro~správu stavu (\textit{State Management}).
	\end{itemize}
	
	\section{Cloudová platforma Supabase a databáze PostgreSQL}
	Jako hlavní úložiště dat a~poskytovatel backendových služeb jsem vybral platformu Supabase. Jedná se o~systém typu \textit{Backend-as-a-Service} (BaaS) postavený na~relační databázi PostgreSQL. Tento výběr byl strategický z~hlediska podpory geografických dat a~možnosti využít technologii PostGIS pro~vzdálenostní dotazy. Důležitým faktorem pro~volbu této platformy byla rovněž má předchozí praktická zkušenost s~tímto prostředím, což umožnilo efektivnější návrh databázové struktury a~výrazně urychlilo proces následné implementace backendových služeb.
	
	Bezpečnost je řešena přímo na~úrovni databáze pomocí \textit{Row Level Security} (RLS). Každý požadavek je ověřován na~straně serveru, což zajišťuje, že~uživatel může přistupovat pouze ke~svým vlastním logům nebo veřejným keškám. Pro~výpočet globálních statistik a~žebříčků v~reálném čase jsou využívány SQL Views, které agregují data bez~nutnosti přetěžování klientské aplikace.
	
	
	\forceoddpage
	\chapter{Analýza a návrh řešení}
	
	V~této kapitole je popsán proces analýzy trhu, stanovení konkrétních požadavků na~funkcionalitu aplikace a~návrh datové struktury. Tato fáze byla nezbytná pro~pochopení cílové skupiny uživatelů a~eliminaci potenciálních technických rizik.
	
	\section{Analýza stávajících řešení a konkurence}
	Při~návrhu aplikace GeoHunt bylo nutné prozkoumat existující geolokační platformy. Trhu dominuje oficiální aplikace \textit{Geocaching®}, která však pro~neplatící uživatele omezuje řadu funkcí. Dalšími konkurenty jsou české projekty \textit{GEOFUN} nebo \textit{Adventure Lab®}.
	
	Hlavním zjištěním analýzy bylo, že~většina aplikací se soustředí buď na~fyzické schránky (tradiční geocaching), nebo na~statické textové úkoly. GeoHunt tuto mezeru vyplňuje zavedením virtuálních kešek na~reálných souřadnicích, jejichž odemčení je podmíněno úspěšným splněním dovednostní mini-hry. Tímto způsobem se aplikace stává dynamičtější a~atraktivnější pro~mladší generaci hráčů.
	
	
	\section{Specifikace funkčních a nefunkčních požadavků}
	Na~základě analýzy byly stanoveny priority vývoje rozdělené do~dvou kategorií.
	
	\subsection{Funkční požadavky}
	\begin{itemize}
		\item \textbf{Autentizace:} Registrace a~přihlášení pomocí emailu nebo Google účtu.
		\item \textbf{Mapové rozhraní:} Zobrazení aktuální polohy uživatele a~kešek v~blízkém okolí.
		\item \textbf{Herní mechanika:} Detekce blízkosti kešky (do~20 metrů) a~spuštění mini-hry.
		\item \textbf{Statistiky:} Real-time žebříček nejlepších hráčů na~základě počtu nálezů.
		\item \textbf{Offline mód:} Možnost stažení dat pro~využití v~lesním terénu bez~signálu.
	\end{itemize}
	
	\subsection{Nefunkční požadavky}
	\begin{itemize}
		\item \textbf{Vysoký výkon:} Plynulý rendering mapy i~při velkém počtu bodů (clustering).
		\item \textbf{Bezpečnost:} Ochrana databáze proti neoprávněným zápisům (RLS).
		\item \textbf{Multiplatformita:} Funkčnost na~systémech Android i~iOS.
	\end{itemize}
	
	
	\section{Návrh uživatelského rozhraní (UI) a zkušenosti (UX)}
	Cílem návrhu UI bylo vytvořit čisté a~intuitivní prostředí, které nebude uživatele v~terénu rozptylovat. Dominantním prvkem je interaktivní mapa využívající podklady OpenStreetMap. Pro~interakci s~keškami byla navržena vizuální signalizace – kešky mění barvu na~základě stavu (nalezeno/nenalezeno).
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.4\textwidth]{img/ui_map.png}
		\caption{Vizuální návrh mapové části.}
		\label{fig:ui_map}
	\end{figure}
	
	
	\section{Návrh databázového schématu a bezpečnostních pravidel}
	Jádrem systému je relační model v~PostgreSQL. Schéma se skládá ze~tří hlavních entit: \textit{profiles} (data o~uživatelích), \textit{geocaches} (souřadnice a~popisy bodů) a~\textit{logs} (záznamy o~nálezech). Vztahy mezi tabulkami jsou řešeny pomocí cizích klíčů, což zajišťuje referenční integritu.
	
	\subsection{Row Level Security (RLS)}
	Bezpečnostní politika byla nastavena tak, aby zápis do~tabulky \textit{logs} mohl provést pouze autentizovaný uživatel pro~své vlastní ID. Veřejné kešky jsou přístupné pro~čtení všem, ale jejich editace je omezena pouze na~uživatele s~rolí \textit{admin}. Tato vrstva ochrany přímo v~databázi nahrazuje složitou logiku na~straně serveru.
	
	\forceoddpage
	
	\chapter{Realizace mobilní aplikace}
	V~této kapitole je popsán technický postup vývoje aplikace GeoHunt. Pozornost je věnována konfiguraci vývojového prostředí, implementaci klíčových modulů a~propojení klientské části s~cloudovým backendem.
	
	\section{Inicializace projektu a konfigurace prostředí}
	Vývoj byl zahájen vytvořením nového projektu ve~frameworku Flutter. Pro~zajištění bezpečnosti citlivých údajů, jako jsou API klíče k~Supabase nebo Google Maps (které nakonec nebyly použity), byl do~projektu integrován balíček \textit{flutter\_dotenv}. Tyto údaje jsou uloženy v~souboru \textit{.env}, který není součástí veřejného repozitáře, čímž je zamezeno jejich zneužití.
	
	Struktura projektu byla od~počátku organizována podle pravidel \textit{Clean Architecture}. Složka \textit{lib/} byla rozdělena na~podadresáře \textit{core} (sdílené prvky) a~\textit{features}, kde každá funkce aplikace (např. mapa, autentizace, žebříčky) má svou vlastní logiku oddělenou od~ostatních.
	
	\section{Implementace autentizačního systému}
	Pro~přihlašování uživatelů byla využita služba \textit{Supabase Auth}. Systém podporuje dvě metody: klasickou registraci pomocí emailu a~hesla a~nativní \textit{Google OAuth2} přihlášení.
	
	\subsection{Logika AuthGuard a správa relací}
	Klíčovou součástí realizace bylo vytvoření widgetu \textit{AuthGuard}. Ten využívá \textit{StreamBuilder} k~poslechu stavu autentizace v~reálném čase. Pokud uživatel není přihlášen, aplikace automaticky zobrazí přihlašovací obrazovku. Po~úspěšném ověření identity je uživatel přesměrován na~hlavní mapové rozhraní. Tato logika zajišťuje, že~nepovolané osoby nemají přístup k~hernímu obsahu.
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.4\textwidth]{img/login_ui.jpg}
		\caption{Vizuální návrh přihlašování.}
		\label{fig:login_ui}
	\end{figure}
	
	\section{Integrace mapového engine a práce s geografickými daty}
	Vzhledem k~požadavku na~využití otevřených standardů byl zvolen balíček \textit{flutter\_map} ve~spojení s~OpenStreetMap. Na~rozdíl od~Google Maps SDK toto řešení umožňuje plnou kontrolu nad~vizuálním stylem mapy bez~nutnosti platit licenční poplatky při vysokém počtu zobrazení.
	
	Pro~určování polohy uživatele v~reálném čase je využívána knihovna \textit{geolocator}, která přistupuje k~GPS modulu zařízení s~vysokou přesností. Souřadnice jsou v~aplikaci reprezentovány objekty typu \textit{LatLng}, se kterými pracují všechny výpočetní moduly.
	
\section{Vývoj herních
	mechanik a dovednostních mini-her}
Herní smyčka začíná v~modulu pro~detekci vzdálenosti. Aplikace periodicky vypočítává vzdálenost mezi aktuální polohou hráče a~nejbližší keškou pomocí algoritmu \textit{Haversine}. Pokud vzdálenost klesne pod~hranici 20 metrů, aktivuje se tlačítko pro~odemčení.
\subsection{Implementace mini-hry AR Coin Hunt}
První dovednostní výzva byla navržena jako interaktivní AR (augmented reality) prvek vyžadující prostorovou orientaci. Hráč drží zařízení jako okno do~virtuálního prostředí a~otáčí se kolem své osy, přičemž kamera společně s~gyroskopeM umožňuje pohled do~360° panoramatu. V~časovém limitu musí hráč najít a~klepnutím na~displej sesbírat náhodně rozmístěné virtuální mince v~okolním prostoru. Po~úspěšném dokončení hry je odeslán požadavek na~Supabase pro~zápis nálezu do~tabulky \textit{logs}.
\subsection{Implementace mini-hry Falling Fragments}
Druhá dovednostní výzva implementuje mechaniku založenou na~senzorech gyroskopu. Hráč ovládá sběrný koš umístěný na~spodní části displeje náklonem telefonu, přičemž herní logika využívá data ze~\texttt{sensors\_plus} balíčku pro~snímání pohybu v~reálném čase s~citlivostí 0.02 radiánů. Cílem je zachytit padající objekty (fragmenty) generované v~náhodných intervalech před~jejich dopadem na~dolní hranici displeje. Po~úspěšném splnění podmínek (nasbírání požadovaného počtu fragmentů) je prostřednictvím asynchronního API volání zaznamenán nález do~tabulky \textit{logs} v~Supabase databázi. Kamera zobrazuje živý stream reálného prostředí s~překrytými herními prvky, což vytváří AR zážitek.
\subsection{Náhodný výběr mini-hry}
Při každém pokusu o~odemčení kešky systém náhodně vybírá mezi těmito dvěma mini-hrami. Tato variabilita zajišťuje, že~hra zůstává zábavná i~při opakovaném hraní a~testuje různé dovednosti hráče.
\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{img/game_ui.jpg}
	\caption{Ukázka herní mechaniky pro odemykání kešky.}
	\label{fig:game_ui}
\end{figure}

\section{Systém hodnocení a recenzí kešek}
Pro~zvýšení interaktivity komunity byl implementován systém hodnocení, který umožňuje hráčům sdílet své zkušenosti s~jednotlivými keš kami. Po~úspěšném odemčení může uživatel ohodnotit kešku hvězdičkami (1–5) a~přidat textový komentář.

\subsection{Implementace databázové struktury}
V~Supabase byla vytvořena tabulka \textit{cache\_reviews} s~relací na~tabulky \textit{geocaches} a~\textit{profiles}. Pro~zobrazení recenzí je využíván SQL JOIN, který spojuje hodnocení s~uživatelskými profily a~načítá jméno autora. Aplikace zobrazuje průměrné hodnocení přímo v~detailu kešky pomocí vizualizace hvězdiček a~seznam nejnovějších komentářů.

\subsection{Row Level Security pro reviews}
Bezpečnostní pravidla byla nakonfigurována tak, aby každý autentizovaný uživatel mohl číst všechny recenze, ale vkládat pouze své vlastní hodnocení. Tím je zabráněno spamu a~manipulaci s~daty.
	
	
	
	\forceoddpage
	
	\chapter{Specifické technické výzvy a jejich řešení}
	
	Tato kapitola se zaměřuje na~nejsložitější technické problémy, které bylo nutné během vývoje vyřešit pro~zajištění produkční kvality aplikace GeoHunt.
	
	\section{Optimalizace vykreslování velkého množství bodů (Clustering)}
	Při~testování aplikace s~reálnými daty, která obsahují desítky tisíc záznamů o~keškách, došlo k~výraznému poklesu snímkové frekvence (FPS). Standardní vykreslování každého bodu jako samostatného markeru "zabilo" UI vlákno aplikace.
	
	Řešením bylo nasazení balíčku \textit{flutter\_map\_marker\_cluster}. Tato technologie shlukuje body do~skupin (clusterů) na~základě aktuální úrovně přiblížení. K~rozbalení clusteru na~jednotlivé body dochází až při dostatečném zoomu. Tím se počet aktivních prvků na~displeji snížil z~tisíců na~desítky, což zajistilo plynulost mapy i~na starších zařízeních.
	
	\section{Implementace offline režimu a lokálního úložiště SQLite}
	Geocaching často probíhá v~místech se špatným signálem. Pro~zajištění funkčnosti byla implementována vrstva \textit{OfflineCacheService} využívající databázi \textit{sqflite}. Uživatel má možnost stáhnout data o~keškách do~lokální paměti zařízení. Aplikace v~reálném čase detekuje stav připojení a~v~případě výpadku signálu automaticky přepne zdroje dat (\textit{Repository}) ze~Supabase na~lokální SQLite.
	
	\section{Logika synchronizace dat mezi klientem a serverem}
	Zápis nálezů v~offline režimu představoval výzvu pro~integritu dat. Byl vytvořen systém dočasných logů. Pokud hráč odemkne kešku offline, záznam se uloží do~lokální tabulky \textit{offline\_logs}. Aplikace na~pozadí sleduje obnovení konektivity (\textit{ConnectivityResult.wifi} nebo \textit{mobile}) a~následně spustí proces synchronizace, který odešle všechny nashromážděné záznamy do~cloudu Supabase.
	
	\section{Správa stavu kešek a funkce Reset Cache}
	Klíčovou funkcí pro~administrátory je možnost resetovat stav kešky. Tato operace byla komplikovaná nutností synchronizace mezi lokální SQLite databází a~cloudovým úložištěm Supabase.
	
	\subsection{Implementace reset logiky}
	Funkce \textit{resetCache} provádí dvě operace: v~lokální databázi je keška označena jako zamčená (\textit{isUnlocked = false}) a~zároveň je odeslán DELETE požadavek na~Supabase pro~smazání záznamu z~tabulky \textit{logs}. Pro~okamžitou zpětnou vazbu byl UI navržen tak, aby aktualizoval stav markeru na~mapě bez~nutnosti restartu aplikace využitím metody \textit{setState} a~\textit{\_rebuildMarkers}.
	
	\subsection{Řešení RLS pro DELETE operace}
	Při prvních testech resetování docházelo k~chybám kvůli chybějícím oprávněním. Problém byl vyřešen vytvořením RLS policy, která povoluje mazání logů pouze samotnému autorovi záznamu:
	
	\begin{lstlisting}[language=SQL, caption=RLS policy pro mazání logů]
		CREATE POLICY "Users can delete their own logs"
		ON logs FOR DELETE TO authenticated
		USING (auth.uid() = user_id);
	\end{lstlisting}
	
	\section{Zobrazení žebříčku nejlepších hráčů}
	Pro~motivaci uživatelů byla implementována obrazovka žebříčku, která zobrazuje statistiky hráčů seřazené podle počtu nalezených kešek. Data jsou načítána dotazem na~tabulku \textit{profiles}, která agreguje počet záznamů z~tabulky \textit{logs} pro~každého uživatele. Aplikace zobrazuje jméno hráče, počet nálezů a~vizuální odznaky (zlatá/stříbrná/bronzová trofej) pro~první tři místa.
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.4\textwidth]{img/leaderboard_ui.png}
		\caption{Uživatelské rozhraní žebříčku nejlepších hráčů.}
		\label{fig:leaderboard_ui}
		
	\end{figure}
	
	
	\forceoddpage
	\chapter{Zhodnocení, testování a nasazení}
	
	Závěrečná fáze projektu se soustředila na~ověření funkčnosti aplikace v~reálných podmínkách a~přípravu pro~veřejné publikování. Tato kapitola popisuje proces testování geolokačních funkcí a~technické překážky spojené s~autentizací v~produkčním prostředí.
	
	\section{Průběh testování v reálném terénu}
	Vzhledem k~povaze aplikace GeoHunt nebylo možné provádět testy pouze v~emulátoru. Proběhlo několik testovacích cyklů v~městské i~lesní zástavbě s~cílem ověřit přesnost GPS modulu a~stabilitu herní smyčky.
	
	Klíčovým bodem byla validace algoritmu pro~detekci blízkosti. Testy potvrdily, že~hranice 20 metrů je ideálním kompromisem mezi herní náročností a~přesností civilního GPS signálu, který může v~husté zástavbě vykazovat odchylky. Rovněž byla ověřena funkčnost offline režimu, kdy aplikace po~ztrátě mobilních dat plynule přešla na~lokální databázi SQLite, umožnila odemčení kešky a~zapsala nález do~synchronizační fronty.
	
	\section{Proces sestavení aplikace (Debug vs. Release build)}
	Během vývoje byly využívány dvě odlišné verze aplikace. Verze \textit{Debug} sloužila k~rychlému ladění chyb pomocí nástroje \textit{Hot Reload}. Pro~finální testování výkonu byl však nutný \textit{Release build}.
	
	Tento proces zahrnuje kompilaci do~nativního kódu pomocí příkazu \textit{flutter build apk}. V~této fázi byl aplikován nástroj \textit{R8}, který provádí optimalizaci kódu (\textit{shrinking}) a~odstraňuje nepoužité části knihoven. Tím došlo k~výraznému snížení velikosti výsledného instalačního souboru a~zvýšení plynulosti animací v~mini-hře.
	
	\section{Řešení problémů s podepisovacími klíči a Google API}
	Největší technickou výzvou při nasazení byla konfigurace služby \textit{Google Sign-In}. Zatímco ve~vývojovém prostředí autentizace fungovala bezchybně, v~produkční verzi (po~podepsání aplikace) docházelo k~chybě \textit{ApiException: 10}.
	
	Příčinou byl nesoulad mezi otisky certifikátů SHA-1. Pro~vyřešení problému bylo nutné:
	\begin{enumerate}
		\item Pomocí nástroje \textit{keytool} extrahovat SHA-1 otisk z~produkčního souboru \textit{keystore}.
		\item Tento otisk zaregistrovat v~konzoli Google Cloud i~v~nastavení projektu Supabase.
		\item Sjednotit \textit{Package Name} (cz.geohunt.app) napříč všemi platformami.
	\end{enumerate}
	Toto řešení zajistilo plnou funkčnost OAuth2 autentizace i~v~distribuované verzi aplikace.
	
	\section{Zhodnocení výsledků a možnosti budoucího rozvoje}
	Projekt GeoHunt úspěšně splnil všechny stanovené cíle. Byla vytvořena stabilní geolokační platforma s~příjemným uživatelským rozhraním a~inovativní herní mechanikou.
	
	V~rámci budoucího rozvoje se nabízí několik směrů:
	\begin{itemize}
		\item \textbf{Uživatelský obsah (UGC):} Rozšíření aplikace o~možnost, aby samotní uživatelé mohli přímo v~terénu navrhovat a~vytvářet své vlastní virtuální kešky, definovat jejich obtížnost a~vkládat k~nim popisy.
		\item \textbf{Sociální interakce:} Implementace systému přátel, sdílení nálezů na~sociální sítě a~možnost skupinového lovu kešek v~reálném čase.
		\item \textbf{Pokročilé AR prvky:} Rozšíření sady mini-her o~interakci s~3D modely objektů (např. virtuální truhly), které by se objevovaly na~konkrétních površích v~prostředí.
	\end{itemize}
	
\forceoddpage
	
	\chapter*{Závěr}
	\addcontentsline{toc}{chapter}{Závěr}
	
	Cílem tohoto maturitního projektu bylo navrhnout a~realizovat moderní geolokační aplikaci GeoHunt, která by propojila tradiční geocaching s~dynamickými herními prvky. Po~dokončení vývojového cyklu lze konstatovat, že~všechny stanovené cíle byly úspěšně splněny.
	
	V~průběhu realizace byla vytvořena robustní mobilní aplikace ve~frameworku Flutter, která efektivně využívá cloudové služby Supabase pro~správu uživatelů a~dat. Za~největší technický přínos práce považuji vyřešení optimalizace zobrazení velkého množství geografických bodů pomocí technologie clusteringu a~implementaci plně funkčního offline režimu. Tyto aspekty zajišťují vysokou uživatelskou hodnotu aplikace i~v~náročných podmínkách terénu bez~přístupu k~síti.
	
	Během vývoje jsem se musel vypořádat s~řadou netriviálních problémů, zejména v~oblasti bezpečnosti a~produkčního nasazení. Řešení nesouladu certifikátů SHA-1 pro~autentizaci Google a~správné nastavení Row Level Security v~databázi PostgreSQL mi přineslo cenné zkušenosti s~architekturou moderních informačních systémů.
	
	Projekt GeoHunt je v~tuto chvíli ve~stavu plně funkčního MVP (Minimum Viable Product). V~budoucnu by bylo možné aplikaci dále rozšiřovat o~prvky rozšířené reality nebo sociální funkce pro~interakci mezi hráči. Práce na~tomto projektu mi umožnila prohloubit znalosti v~oblasti mobilního vývoje, práce s~prostorovými daty a~správy cloudové infrastruktury.
	
	\chapter*{Seznam použité literatury}
	\addcontentsline{toc}{chapter}{Seznam použité literatury}
	
	% Použití číslovaného seznamu dle formátu ISO 690
	\begin{enumerate}[label={[\arabic*]}]
		\item GOOGLE. \textit{Flutter documentation} [online]. 2025 [cit. 2026-01-05]. Dostupné z: \url{https://docs.flutter.dev/}
		\item SUPABASE. \textit{Supabase Docs: The Open Source Firebase Alternative} [online]. 2025 [cit. 2026-01-05]. Dostupné z: \url{https://supabase.com/docs}
		\item POSTGRESQL GLOBAL DEVELOPMENT GROUP. \textit{PostgreSQL 16 Documentation} [online]. 2025 [cit. 2026-01-05]. Dostupné z: \url{https://www.postgresql.org/docs/}
		\item DART. \textit{Dart language guide} [online]. 2025 [cit. 2026-01-05]. Dostupné z: \url{https://dart.dev/guides}
		\item OPENSTREETMAP FOUNDATION. \textit{OpenStreetMap Wiki} [online]. 2025 [cit. 2026-01-05]. Dostupné z: \url{https://wiki.openstreetmap.org/}
		\item MARTIN, Robert C. \textit{Clean Architecture: A Craftsman's Guide to Software Structure and Design}. First edition. Boston: Prentice Hall, 2017. ISBN 978-0134494166.
		\item PUB.DEV. \textit{Flutter Map Marker Cluster package} [online]. 2025 [cit. 2026-01-05]. Dostupné z: \url{https://pub.dev/packages/flutter_map_marker_cluster}
	\end{enumerate}
	
	
	\chapter*{Seznam obrázků}
	\addcontentsline{toc}{chapter}{Seznam obrázků}
	\begin{enumerate}
		\item Vizuální návrh mapové části \dotfill \pageref{fig:ui_map}
		\item Vizuální návrh přihlašování \dotfill \pageref{fig:login_ui}
		\item Ukázka herní mechaniky pro odemykání kešky \dotfill \pageref{fig:game_ui}
		\item Uživatelské rozhraní žebříčku nejlepších hráčů \dotfill \pageref{fig:leaderboard_ui}
	\end{enumerate}

	
\end{document}